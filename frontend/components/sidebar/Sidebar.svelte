<script lang="ts">
    import some from 'lodash/some'

    import type {SidebarItem} from '@/types'

    import SidebarEntry from './SidebarEntry.svelte'

    export let baseUrl: string
    export let items: SidebarItem[]
    export let id = 'sub-sidebar'
    export let percentFunc: (entry: SidebarItem) => number = undefined
    export let width = '10rem'

    let anyChildren: boolean
    $: {
        anyChildren = some(items, (item) => (item?.children?.length ?? 0) > 0)
    }
</script>

<style lang="scss">
    div {
        margin-right: 1rem;
        min-width: var(--width);
        position: sticky;
        top: 0;
        width: var(--width);
    }

    nav {
        --linkColor: #64e1ff;

        border: 1px solid $border-color;
        padding: 0.5rem 0;
        width: 100%;

        ul {
            margin: 0;
        }
    }
</style>

<div style="--width: {width}">
    <slot name="before" />

    <nav id="{id}" class="thing-container">
        <ul>
            {#each items as item}
                <SidebarEntry {anyChildren} {baseUrl} {item} {percentFunc} />
            {/each}
        </ul>
    </nav>

    <slot name="after" />
</div>
